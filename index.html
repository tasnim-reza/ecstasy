<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="utf-8">
    <title>Ecstasy::</title>
    <script src="src/app.js" type="text/javascript"></script>
</head>
<body
        onclick="eventHandler(event, this)"
        onmousedown="eventHandler(event, this)">

<h1>Counter Example</h1>

<input id="buttonDecrement" type="button" value="-"/>

<span id="result">Result: {{count}}</span>
<input type="button" onclick="doLoop()" value="show 10 times"/>

<input id="buttonIncrement" type="button" value="+"/>


<script type="text/javascript">

    //mediator
    function mediator() {
        var participants = {};

        this.register = function (participant) {
            participants[participant.name] = participant;
            participant.mediator = this;
        }

        this.dispatch = function (message, from, to) {
            for(var key in participants){
                if (participants[key] !== from) {
                    participants[key].receive(message, from);
                }
            }
        }
    }

    //producer
    function producer(med, participant) {
        med.register(participant);
    }

    function consumer(med, participant){
        med.dispatch("Hello World", participant);
    }

    var participant = function(name) {
        this.name = name;
        this.chatroom = null;

        this.send = function(message, to) {
            this.chatroom.send(message, this, to);
        };

        this.receive = function(message, from) {
            log.add(from.name + " to " + this.name + ": " + message);
        }
    };

    function executor(){

        var med = new mediator();
        var participant1 = new participant('reza1');
        var participant2 = new participant('reza2');

        new producer(med, participant1);
        new producer(med, participant2);
    }

    function eventHandler(event, element) {
        switch (event.target.id + ':' + event.type) {
            case 'buttonIncrement:click' :
                onIncrement()
                break;
            case 'buttonIncrement:mousedown' :
                onMouseDown()
                break;
            case 'buttonDecrement:click' :
                decrement()
                break;
            default :
                console.log('default')
        }
    }

    var count = 0;
    init();

    //consumer 1
    function decrement() {
        count--;
        show();
    }

    //consumer 1
    function onIncrement() {
        count++;
        show();
    }

    //consumer 1
    function onMouseDown() {
        document.getElementById('buttonIncrement').style = 'background-color: rgb(' + 10 * count + ', ' + 40 * count + ', ' + 30 * count + ');'
    }

    function init() {
        show();
    }

    function doLoop() {
        for (var i = 0; i < 1000000; i++) {
            count++;
            show();
        }
    }

    function show() {
        document.getElementById('result').innerText = count;
    }

</script>
</body>
</html>